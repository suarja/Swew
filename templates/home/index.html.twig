{% extends 'base.html.twig' %}

{% block title %}Workbench · SWE Wannabe{% endblock %}

{% block body %}
    {% set current_path = app.request ? app.request.pathinfo : '/' %}
    {% set normalized_path = current_path == '' ? '/' : current_path %}
    {% set active_route = normalized_path == '/home' ? '/' : normalized_path %}
    {% set known_routes = ['/', '/courses', '/cli', '/docs', '/profile'] %}

    <div class="route-stack" data-component="route-stack">
        <article class="route-view" data-route-view="/" {% if active_route != '/' %}hidden{% endif %}>
            <section class="panel panel--hero">
                <p class="panel__eyebrow">shell · dashboard</p>
                <h1 class="panel__title">Learning by building the hard parts.</h1>
                <p class="panel__subtitle">
                    Strip away abstractions, ship with the same toolchain as the platform, and document every insight like a terminal lab notebook.
                </p>
            </section>

            <section class="panel">
                <header class="panel__header">
                    <div>
                        <h2 class="panel__title">Live run state</h2>
                        <p class="panel__subtitle">Values hydrate from LMS submissions + runner telemetry.</p>
                    </div>
                    <span class="panel__meta">data-source: lms.stream.status</span>
                </header>
                <div class="stat-grid">
                    <article class="stat-card" data-field="active-course">
                        <p class="stat-card__label">Active course</p>
                        <p class="stat-card__value stat-card__value--muted">waiting for sync…</p>
                        <p class="stat-card__hint">populated once /courses API responds</p>
                    </article>
                    <article class="stat-card" data-field="current-task">
                        <p class="stat-card__label">Focused task</p>
                        <p class="stat-card__value stat-card__value--muted">—</p>
                        <p class="stat-card__hint">bound to learner context</p>
                    </article>
                    <article class="stat-card" data-field="runner-status">
                        <p class="stat-card__label">Runner status</p>
                        <p class="stat-card__value stat-card__value--muted">standby</p>
                        <p class="stat-card__hint">Mercure event channel</p>
                    </article>
                </div>
            </section>

            <section class="panel">
                <header class="panel__header">
                    <div>
                        <h2 class="panel__title">How to spin up the dojo</h2>
                        <p class="panel__subtitle">Every contributor uses the same CLI-first workflow.</p>
                    </div>
                </header>
                <ul class="command-list">
                    <li class="command">
                        <div class="command__title">Bootstrap dependencies</div>
                        <code class="command__code">composer install && docker compose build --pull --no-cache</code>
                    </li>
                    <li class="command">
                        <div class="command__title">Start the stack</div>
                        <code class="command__code">docker compose up --wait</code>
                    </li>
                    <li class="command">
                        <div class="command__title">Enter the PHP container</div>
                        <code class="command__code">docker exec -it app-php-1 bash</code>
                    </li>
                    <li class="command">
                        <div class="command__title">Watch CLI assets</div>
                        <code class="command__code">php bin/console typescript:build --watch</code>
                    </li>
                </ul>
            </section>

            <section class="panel panel--note">
                <h2 class="panel__title">Principles of this build</h2>
                <ul class="list-plain">
                    <li>Keep new UI components minimal, monochrome, and copy-light—every label should feel like a command palette entry.</li>
                    <li>Reference <code>docs/brand.md</code> and <code>docs/prd.md</code> before merging; update them if behavior shifts.</li>
                    <li>Document each workflow slice (GitHub App, runner, Mercure events) directly inside pull requests.</li>
                </ul>
            </section>
        </article>

        <article class="route-view" data-route-view="/courses" {% if active_route != '/courses' %}hidden{% endif %}>
            <section class="panel panel--hero">
                <p class="panel__eyebrow">shell · courses</p>
                <h1 class="panel__title">Course map</h1>
                <p class="panel__subtitle">Progression built around first-principles depth, not flashy demos.</p>
            </section>
            <section class="panel">
                <header class="panel__header">
                    <div>
                        <h2 class="panel__title">LMS feed</h2>
                        <p class="panel__subtitle">Courses render here after `/api/courses` responds.</p>
                    </div>
                    <span class="panel__meta">collection: courses</span>
                </header>
                <div class="empty-state" data-collection="courses">
                    <p class="empty-state__label">No courses loaded.</p>
                    <p class="empty-state__hint">Connect the LMS service or seed fixtures to preview the layout.</p>
                </div>
                <div class="data-grid" aria-live="polite"></div>
            </section>
        </article>

        <article class="route-view" data-route-view="/cli" {% if active_route != '/cli' %}hidden{% endif %}>
            <section class="panel panel--hero">
                <p class="panel__eyebrow">shell · cli</p>
                <h1 class="panel__title">CLI rituals</h1>
                <p class="panel__subtitle">Every command reads like a lab notebook entry.</p>
            </section>
            <section class="panel">
                <ul class="command-list">
                    <li class="command">
                        <div class="command__title">Login</div>
                        <code class="command__code">swew login</code>
                    </li>
                    <li class="command">
                        <div class="command__title">Task briefing</div>
                        <code class="command__code">swew open &lt;task&gt;</code>
                    </li>
                    <li class="command">
                        <div class="command__title">Doctor</div>
                        <code class="command__code">swew doctor</code>
                    </li>
                    <li class="command">
                        <div class="command__title">Status stream</div>
                        <code class="command__code">swew status --watch</code>
                    </li>
                </ul>
            </section>
        </article>

        <article class="route-view" data-route-view="/docs" {% if active_route != '/docs' %}hidden{% endif %}>
            <section class="panel panel--hero">
                <p class="panel__eyebrow">shell · documentation</p>
                <h1 class="panel__title">Documentation uplink</h1>
                <p class="panel__subtitle">Keep brand, product, and engineering specs in lockstep.</p>
            </section>
            <section class="panel">
                <ul>
                    <li><code>docs/brand.md</code> — tone, aesthetics, and audience cues.</li>
                    <li><code>docs/prd.md</code> — MVP scope, system diagram, constraints.</li>
                    <li><code>AGENTS.md</code> — contributor workflow, commands, and PR etiquette.</li>
                </ul>
            </section>
        </article>

        <article class="route-view" data-route-view="/profile" {% if active_route != '/profile' %}hidden{% endif %}>
            <section class="panel panel--hero">
                <p class="panel__eyebrow">shell · profile</p>
                <h1 class="panel__title">Account overview</h1>
                <p class="panel__subtitle">Session cookies keep you signed in on this browser. Revoke tokens to log out your CLI.</p>
            </section>
            <section class="panel">
                <header class="panel__header">
                    <div>
                        <h2 class="panel__title">Identity</h2>
                        <p class="panel__subtitle">Data pulled from Doctrine `user` table.</p>
                    </div>
                    <span class="panel__meta">role set</span>
                </header>
                <div class="stat-grid">
                    <article class="stat-card">
                        <p class="stat-card__label">Name</p>
                        <p class="stat-card__value">{{ app.user.name }}</p>
                    </article>
                    <article class="stat-card">
                        <p class="stat-card__label">Email</p>
                        <p class="stat-card__value">{{ app.user.email }}</p>
                    </article>
                    <article class="stat-card">
                        <p class="stat-card__label">Roles</p>
                        <p class="stat-card__value">{{ app.user.roles|join(', ') }}</p>
                    </article>
                </div>
            </section>
            <section class="panel panel--note">
                <h2 class="panel__title">CLI tokens</h2>
                <p>Create or revoke tokens via <code>php bin/console app:token:create</code>. Tokens are hashed server-side and can be rotated any time.</p>
                <ul class="list-plain">
                    <li>Tokens authenticate requests to <code>/api/*</code> endpoints via `Authorization: Bearer &lt;token&gt;` headers.</li>
                    <li>Device sessions (web) use secure, HTTP-only cookies scoped to <code>{{ app.request.host }}</code>.</li>
                    <li>Revoke compromised tokens by deleting them in the DB or via a future admin UI.</li>
                </ul>
            </section>
        </article>

        <article class="route-view" data-route-view="__fallback" {% if active_route in known_routes %}hidden{% endif %}>
            <section class="panel panel--hero">
                <h1 class="panel__title">Route not instrumented</h1>
                <p class="panel__subtitle">This path is not wired yet. Circle back to the roadmap in <code>docs/prd.md</code>.</p>
            </section>
        </article>
    </div>
{% endblock %}
